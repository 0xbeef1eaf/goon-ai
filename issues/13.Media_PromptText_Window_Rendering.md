## Objective
Implement text prompt/message window rendering using wgpu for displaying text content.
## Tasks
### 1. Prompt Module Structure
- [ ] Create prompt rendering module:
  ```
  src/
  └── media/
      └── prompt/
          ├── mod.rs
          ├── renderer.rs       // Text rendering with wgpu
          └── layout.rs         // Text layout and formatting
  ```
### 2. Text Rendering Library
- [ ] Choose text rendering approach:
  - **Option 1**: `wgpu_glyph` - GPU text rendering
  - **Option 2**: `fontdue` + custom wgpu integration
  - **Option 3**: `cosmic-text` - Advanced text layout
- [ ] Recommended: **cosmic-text** for rich text support
### 3. Text Renderer Implementation
- [ ] Implement `PromptRenderer`:
  ```rust
  pub struct PromptRenderer {
      text_system: TextSystem,
      buffer: Buffer,
      pipeline: wgpu::RenderPipeline,
      atlas: TextAtlas,
  }
  ```
- [ ] Features:
  - Multi-line text support
  - Text wrapping
  - Alignment (left, center, right)
  - Font size control
  - Color customization
  - Background color/opacity
### 4. Font Management
- [ ] Load system fonts or bundled fonts
- [ ] Support custom fonts from pack (future)
- [ ] Font fallback mechanism
- [ ] Cache glyph atlases for performance
### 5. Text Layout
- [ ] Implement text layout engine:
  - Calculate text dimensions
  - Handle line breaks
  - Word wrapping
  - Padding/margins
- [ ] Auto-size window to text content
- [ ] Support maximum width/height constraints
### 6. Styling Options
- [ ] Define `PromptOptions`:
  ```rust
  struct PromptOptions {
      text: String,
      font_size: f32,
      color: [f32; 4],           // RGBA
      background: Option<[f32; 4]>,
      padding: f32,
      max_width: Option<u32>,
      alignment: TextAlignment,
      // Window options
      duration: Option<f64>,
      position: Option<(i32, i32)>,
      always_on_top: bool,
      opacity: f32,
  }
  ```
### 7. Op Implementation
- [ ] `op_show_prompt`:
  ```rust
  async fn op_show_prompt(
      state: Rc<RefCell<OpState>>,
      text: String,
      options: Option<PromptOptions>,
  ) -> Result<WindowHandle>
  ```
- [ ] Create window sized to text
- [ ] Render text with styling
- [ ] Return window handle
- [ ] Auto-close after duration
### 8. Rich Text Support (Future)
- [ ] Basic markdown support
- [ ] Bold, italic, underline
- [ ] Color spans
- [ ] Links (if interactive)
### 9. Window Integration
- [ ] Create prompt window
- [ ] Size to text dimensions (with max constraints)
- [ ] Apply styling and window options
- [ ] Center on screen by default
### 10. Dependencies to Add
```toml
[dependencies]
# (existing dependencies)
cosmic-text = "0.12"
# OR
# wgpu_glyph = "0.20"
# glyph_brush = "0.7"
```
### 11. Performance Optimization
- [ ] Cache rendered text textures
- [ ] Efficient glyph atlas updates
- [ ] Minimize texture uploads
- [ ] Reuse text buffers
### 12. Accessibility
- [ ] Readable default fonts
- [ ] Sufficient contrast
- [ ] Reasonable default sizes
- [ ] Screen reader support (future)
## Example Usage (TypeScript)
```typescript
// Show a simple text prompt
const handle = await showPrompt("Take a deep breath...", {
    fontSize: 32,
    color: [1.0, 1.0, 1.0, 1.0],  // White
    background: [0.0, 0.0, 0.0, 0.8],  // Semi-transparent black
    duration: 5,
    alwaysOnTop: true,
    position: { x: 960, y: 540 }  // Center of 1080p screen
});
// Show a message with custom styling
await showPrompt("You are feeling relaxed...", {
    fontSize: 48,
    color: [0.5, 0.8, 1.0, 1.0],  // Light blue
    padding: 20,
    maxWidth: 800,
    alignment: "center"
});
```
## Acceptance Criteria
- [ ] Text renders clearly and legibly
- [ ] Window sizes to text content
- [ ] Styling options work correctly
- [ ] Multi-line text and wrapping work
- [ ] Auto-close works after duration
- [ ] Window options are respected
- [ ] Performance is good (fast rendering)
- [ ] Works on all target platforms
- [ ] Font rendering is crisp
## Dependencies
- Requires: #9 GUI Window Manager
- Requires: #6 deno_core Runtime Setup
- Requires: #8 Permissions System
## Related Issues
- #1 Architecture Documentation
- #10 Image Rendering
