## Objective
Implement the window management system using winit and wgpu to create customizable GUI windows with features like always-on-top, click-through, and opacity control.
## Tasks
### 1. GUI Module Structure
- [ ] Create GUI module:
  ```
  src/
  └── gui/
      ├── mod.rs
      ├── window_manager.rs  // Window lifecycle management
      ├── window.rs          // Individual window wrapper
      ├── renderer.rs        // wgpu rendering setup
      └── event_loop.rs      // Event handling
  ```
### 2. Window Manager
- [ ] Implement `WindowManager`:
  - Track all active windows
  - Create new windows on demand
  - Close windows by handle
  - Manage window lifecycle
  - Thread-safe access (Arc<Mutex<WindowManager>>)
- [ ] Window handle system:
  ```rust
  pub struct WindowHandle(Uuid);
  ```
### 3. Window Configuration
- [ ] Define `WindowOptions`:
  ```rust
  struct WindowOptions {
      title: Option<String>,
      position: Option<(i32, i32)>,
      size: Option<(u32, u32)>,
      always_on_top: bool,
      decorations: bool,
      opacity: f32,           // 0.0 to 1.0
      click_through: bool,
      resizable: bool,
      visible: bool,
  }
  ```
- [ ] Implement platform-specific features:
  - Click-through (requires platform-specific code)
  - Always on top
  - Opacity/transparency
### 4. winit Integration
- [ ] Set up winit event loop:
  - Run on main thread (required on macOS)
  - Handle window events
  - Support multiple windows
  - Coordinate with tokio runtime
- [ ] Implement window creation:
  ```rust
  let window = WindowBuilder::new()
      .with_title(title)
      .with_position(position)
      .with_decorations(decorations)
      .with_transparent(true)
      .with_always_on_top(always_on_top)
      .build(&event_loop)?;
  ```
### 5. wgpu Setup
- [ ] Initialize wgpu for each window:
  - Create surface from window
  - Set up render pipeline
  - Configure for 2D rendering
  - Support transparency
- [ ] Implement basic renderer:
  ```rust
  struct Renderer {
      device: wgpu::Device,
      queue: wgpu::Queue,
      surface: wgpu::Surface,
      config: wgpu::SurfaceConfiguration,
  }
  ```
### 6. Event Handling
- [ ] Handle window events:
  - Close requested
  - Resize
  - Redraw requested
  - Focus change
  - Mouse events (if not click-through)
- [ ] Propagate events to content renderers
- [ ] Support window-specific event handlers
### 7. Platform-Specific Features
- [ ] **Linux/X11**:
  - Click-through: `_NET_WM_WINDOW_TYPE_UTILITY`
  - Always on top: `_NET_WM_STATE_ABOVE`
  - Opacity: `_NET_WM_WINDOW_OPACITY`
- [ ] **Windows**:
  - Click-through: `WS_EX_TRANSPARENT` | `WS_EX_LAYERED`
  - Always on top: `HWND_TOPMOST`
  - Opacity: `SetLayeredWindowAttributes`
- [ ] **macOS**:
  - Click-through: `setIgnoresMouseEvents:`
  - Always on top: `setLevel:NSFloatingWindowLevel`
  - Opacity: `setAlphaValue:`
### 8. Window Lifecycle
- [ ] Auto-close with timeout:
  - Optional duration parameter
  - Countdown timer
  - Automatic cleanup
- [ ] Manual close via handle
- [ ] Cleanup resources on close:
  - wgpu resources
  - Window handle
  - Associated content
### 9. Multi-Window Support
- [ ] Support multiple simultaneous windows
- [ ] Each window has independent renderer
- [ ] Coordinate event loop across windows
- [ ] Limits based on settings (max image/video windows)
### 10. Dependencies to Add
```toml
[dependencies]
# (existing dependencies)
winit = "0.30"
wgpu = "22"
raw-window-handle = "0.6"
uuid = { version = "1", features = ["v4"] }
```
### 11. Testing
- [ ] Test window creation/destruction
- [ ] Verify platform-specific features
- [ ] Test multiple windows
- [ ] Memory leak testing
## Platform Support
### Primary Platforms
- Linux (X11 and Wayland)
- Windows 10/11
- macOS
### Known Limitations
- Click-through may not work perfectly on Wayland
- Some features require compositor support on Linux
- macOS requires main thread for window operations
## Acceptance Criteria
- [ ] Can create windows with custom options
- [ ] Always-on-top works on all platforms
- [ ] Opacity control functions correctly
- [ ] Click-through works (with platform limitations)
- [ ] Multiple windows supported
- [ ] Windows close properly on timeout
- [ ] Resources cleaned up on close
- [ ] No window decorations when disabled
- [ ] Performance is acceptable (60 FPS rendering)
## Dependencies
- Requires: #[Core Initialization]
## Related Issues
- #2 Architecture Documentation
- #[Media Rendering]
- #[deno_core Runtime Setup]
