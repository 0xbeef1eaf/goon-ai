## Objective
Implement TypeScript to JavaScript compilation using SWC to validate LLM-generated code before execution.
## Tasks
### 1. TypeScript Module Structure
- [ ] Create TypeScript module:
  ```
  src/
  └── typescript/
      ├── mod.rs
      ├── compiler.rs       // SWC compilation
      ├── sdk_generator.rs  // Generate SDK definitions
      └── error.rs          // Compilation error handling
  ```
### 2. SWC Integration
- [ ] Implement `TypeScriptCompiler`:
  - Configure SWC for TypeScript compilation
  - Target modern JavaScript (ES2020+)
  - Enable strict type checking
  - Preserve source maps for error reporting
- [ ] Handle SWC configuration:
  ```rust
  swc_ecma_parser::TsConfig {
      tsx: false,
      decorators: false,
      dts: false,
      no_early_errors: false,
      dynamic_import: true,
  }
  ```
### 3. Compilation Process
- [ ] Implement compile method:
  - Input: TypeScript source code
  - Process: Compile with type definitions
  - Output: JavaScript code or compilation errors
- [ ] Include SDK type definitions in compilation:
  - Generate `.d.ts` file content
  - Provide to compiler as ambient types
  - Ensure all SDK functions are typed
### 4. Error Handling
- [ ] Parse SWC compilation errors:
  - Extract error messages
  - Include line and column numbers
  - Format for human readability (for LLM)
- [ ] Create structured error type:
  ```rust
  struct CompilationError {
      message: String,
      line: usize,
      column: usize,
      source_snippet: String,
  }
  ```
### 5. Type Definition Generation
- [ ] Generate TypeScript definitions from Rust bindings
- [ ] Support different permission levels:
  - Only include functions user has permission for
  - Generate type-safe interfaces
  - Include JSDoc comments for LLM context
- [ ] Example SDK interface:
  ```typescript
  /**
   * Display an image on screen
   * @param path - Asset path or tag query
   * @param options - Display options
   */
  async function showImage(
    path: string,
    options?: {
      duration?: number;
      opacity?: number;
      position?: { x: number; y: number };
      alwaysOnTop?: boolean;
    }
  ): Promise<WindowHandle>;
  ```
### 6. Caching
- [ ] Cache compiled JavaScript:
  - Hash TypeScript input
  - Reuse cached JS if input unchanged
  - Clear cache on SDK definition changes
### 7. Dependencies to Add
```toml
[dependencies]
# (existing dependencies)
swc = "0.280"
swc_common = "0.36"
swc_ecma_ast = "0.118"
swc_ecma_parser = "0.149"
swc_ecma_codegen = "0.155"
```
### 8. Validation
- [ ] Validate TypeScript syntax before compilation
- [ ] Ensure all referenced SDK functions exist
- [ ] Check for common mistakes (missing await, etc.)
## Acceptance Criteria
- [ ] Can compile valid TypeScript to JavaScript
- [ ] Compilation errors are detailed and actionable
- [ ] SDK type definitions are correctly generated
- [ ] Only permitted functions are included in SDK
- [ ] Errors include line numbers and context
- [ ] Performance is acceptable (< 100ms for typical code)
## Dependencies
- Requires: #[Permissions System]
- Requires: #[Rust Bindings & SDK Generation]
## Related Issues
- #2 Architecture Documentation
- #[deno_core Runtime Setup]
- #[LLM Integration]